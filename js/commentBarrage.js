if(void 0===testjsflag){var testjsflag;const e={colors:[["rgba(56,106,178,0.93)","rgba(255,255,255,0.8)"],["rgba(146, 72, 240,0.93)","rgba(255,255,255,0.8)"],["rgba(45, 165, 93,0.93)","rgba(255,255,255,0.8)"],["rgba(255, 197, 5,0.93)","rgba(255,255,255,0.9)"],["rgba(212, 78, 48,0.93)","rgba(255,255,255,0.8)"]],maxBarrage:2,barrageTime:3e3,twikooUrl:"https://twikoo.happyking.top",accessToken:"034b789cb954d752ee9e8e146c9d1a91",pageUrl:window.location.pathname,barrageTimer:[],barrageList:[],barrageIndex:0,dom:document.querySelector(".comment-barrage")};function initCommentBarrage(){console.log("成功初始化文章弹幕列表x你知道太多了x");var a=JSON.stringify({event:"COMMENT_GET","commentBarrageConfig.accessToken":e.accessToken,url:e.pageUrl}),r=new XMLHttpRequest;r.withCredentials=!0,r.addEventListener("readystatechange",(function(){4===this.readyState&&(e.barrageList=commentLinkFilter(JSON.parse(this.responseText).data),e.dom.innerHTML="")})),r.open("POST",e.twikooUrl),r.setRequestHeader("Content-Type","application/json"),r.send(a),setInterval((()=>{e.barrageList.length&&(popCommentBarrage(e.barrageList[e.barrageIndex]),e.barrageIndex+=1,e.barrageIndex%=e.barrageList.length),e.barrageTimer.length>(e.barrageList.length>e.maxBarrage?e.maxBarrage:e.barrageList.length)&&removeCommentBarrage(e.barrageTimer.shift())}),e.barrageTime)}function commentLinkFilter(e){e.sort(((e,a)=>e.created-a.created));let a=[];return e.forEach((e=>{a.push(...getCommentReplies(e))})),a}function getCommentReplies(e){if(e.replies){let a=[e];return e.replies.forEach((e=>{a.push(...getCommentReplies(e))})),a}return[]}function popCommentBarrage(a){let r=document.createElement("div");e.dom.clientWidth,e.dom.clientHeight;r.className="comment-barrage-item";let t=Math.floor(Math.random()*e.colors.length);r.style.background=e.colors[t][0],r.style.color=e.colors[t][1],r.innerHTML=`\n\t\t<div class="barrageHead">\n\t\t\t<div class="barrageNick">${a.nick}</div>\n\t\t\t<img class="barrageAvatar" src="https://cravatar.cn/avatar/${a.mailMd5}"/>\n\t\t</div>\n\t\t<div class="barrageContent">${a.comment}</div>\n\t`,e.barrageTimer.push(r),e.dom.append(r)}function removeCommentBarrage(a){a.className="comment-barrage-item out",setTimeout((()=>{e.dom.removeChild(a)}),1e3)}initCommentBarrage()}