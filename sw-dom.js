document.addEventListener("DOMContentLoaded",(()=>{const e=e=>new Promise((t=>{const o=e.endsWith("js")?"script":"link",r=4===o.length?"href":"src";for(let n of document.querySelectorAll(o)){const s=n[r];if(e.length>s?e.endsWith(s):s.endsWith(e)){const e=document.createElement(o),r=n.text||n.textContent||n.innerHTML||"";return Array.from(n.attributes).forEach((t=>e.setAttribute(t.name,t.value))),e.appendChild(document.createTextNode(r)),n.parentNode.replaceChildren(e,n),t(!0)}}t(!1)}));var t;"serviceWorker"in navigator&&navigator.serviceWorker.controller&&(sessionStorage.getItem("updated")?(console.log("sw已更新"),sessionStorage.removeItem("updated")):(t="update",navigator.serviceWorker.controller.postMessage(t)),navigator.serviceWorker.addEventListener("message",(t=>{const o=t.data;switch(o.type){case"update":const t=o.update;if(!t)break;sessionStorage.setItem("updated","1"),window.Pjax?.isSupported()?Promise.all(t.map((t=>t.endsWith(".js")||t.endsWith(".css")?e(t):Promise.resolve(t.endsWith(".json")||((e,t)=>{if(e.endsWith("/")&&t.endsWith("/")||e.endsWith("/index.html")&&t.endsWith("/index.html")){let o=0;for(let r=e.length-1,n=t.length-1;e[r]===t[n];--r,--n)if("/"===e[r]&&2==++o)return!0}return!1})(t,location.href))))).then((e=>{for(let t of e)if(t)return location.reload();sessionStorage.removeItem("updated"),console.log("sw已更新")})):location.reload();break;case"refresh":location.reload()}})))}));